<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¥∏‡µç‡¥Æ‡¥æ‡µº‡¥ü‡µç‡¥ü‡µç ‡¥´‡¥æ‡¥Ç ‡¥Ö‡¥∏‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡¥®‡µç‡¥±‡µç - ‡¥´‡¥≤‡¥ô‡µç‡¥ô‡µæ</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --green-primary: #4CAF50;
            --green-light: #e8f5e9;
            --gray-text: #555;
            --background-color: #f0f4f7;
            --dark-green-bg: #4c8a5a;
            --red-alert: #dc3545;
            --yellow-warn: #ffc107;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); line-height: 1.6; color: #333; }
        
        /* Navigation Bar */
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 50px; background: #ffffff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .navbar-logo .title { font-size: 1.5rem; font-weight: 600; }
        .navbar-logo .tagline { font-size: 0.8rem; color: var(--gray-text); }
        .navbar-menu { display: flex; justify-content: space-between; align-items: center; gap: 20px; }
        .navbar-menu a { text-decoration: none; color: #555; font-weight: 500; padding: 8px 15px; border-radius: 20px; transition: background-color 0.3s, color 0.3s; }
        .navbar-menu a.active { background-color: var(--green-primary); color: white; }

        /* Result Box */
        .container { display: flex; justify-content: center; align-items: flex-start; padding: 40px 20px; }
        .result-box { background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 800px; width: 100%; line-height: 1.8; }
        
        h2 { color: var(--green-primary); margin-bottom: 15px; border-bottom: 2px solid var(--green-light); padding-bottom: 10px; }
        h3 { color: var(--dark-green-bg); margin-top: 20px; margin-bottom: 10px; }
        
        .section { margin-bottom: 25px; padding: 10px 0; }
        
        .info-pair { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dashed #eee; }
        .info-pair:last-of-type { border-bottom: none; }
        
        .info-pair .label { font-weight: 500; color: #333; }
        .info-pair .value { font-weight: 600; color: var(--gray-text); }
        
        /* Cost Specific Styles */
        .cost-section .info-pair .value { color: var(--red-alert); }
        .total { 
            font-size: 1.4rem; 
            font-weight: 700; 
            color: var(--green-primary); 
            margin-top: 20px; 
            border-top: 3px solid var(--green-primary); 
            padding-top: 15px; 
            text-align: center;
        }
        .missing-data-box {
            background-color: #ffe0e6;
            color: var(--red-alert);
            border: 2px solid var(--red-alert);
            text-align: center;
        }
        
    </style>
</head>
<body>

    <div class="navbar">
        <div class="navbar-logo">
            <div>
               <div class="title">üå±‡¥∏‡µç‡¥Æ‡¥æ‡µº‡¥ü‡µç‡¥ü‡µç ‡¥´‡¥æ‡¥Ç ‡¥Ö‡¥∏‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡¥®‡µç‡¥±‡µç</div>
                <div class="tagline">IOT ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ö‡µç‡¥ö‡µÅ‡¥≥‡µç‡¥≥ ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥Æ‡¥æ‡µº‡¥ó‡µç‡¥ó‡¥®‡¥ø‡µº‡¥¶‡µç‡¥¶‡µá‡¥∂ ‡¥∏‡¥Ç‡¥µ‡¥ø‡¥ß‡¥æ‡¥®‡¥Ç</div>
            </div>
        </div>
        <div class="navbar-menu">
         <a href="index4.html" >‡¥π‡µã‡¥Ç</a>
            <a href="farmdata4.html">‡¥´‡¥æ‡¥Ç ‡¥°‡¥æ‡¥±‡µç‡¥±</a>
            <a href="results4.html"class="active">‡¥´‡¥≤‡¥ô‡µç‡¥ô‡µæ</a>
            <a href="monitoring4.html">‡¥®‡¥ø‡¥∞‡µÄ‡¥ï‡µç‡¥∑‡¥£‡¥Ç</a>
            <a href="profile4.html">‡¥™‡µç‡¥∞‡µä‡¥´‡µà‡µΩ</a>
            
        </div>
    </div>

    <div class="container">
        <div id="result" class="result-box">
            <h1>‡¥∂‡µÅ‡¥™‡¥æ‡µº‡¥∂‡¥ï‡µæ ‡¥™‡µç‡¥∞‡µã‡¥∏‡¥∏‡µç‡¥∏‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ...</h1>
            <p style="text-align: center;">‡¥à ‡¥∏‡¥®‡µç‡¥¶‡µá‡¥∂‡¥Ç ‡¥§‡µÅ‡¥ü‡¥∞‡µÅ‡¥ï‡¥Ø‡¥æ‡¥£‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ, ‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥≤‡µã‡¥ó‡¥ø‡µª ‡¥®‡¥ø‡¥≤ ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.</p>
        </div>
    </div>

<script>
// --- Configuration ---
const USER_DATA_KEY = "currentUser";
const FORM_DATA_PREFIX = "farmData_";
const PH_OPTIMAL = 6.5;

// --- Global Functions ---
function logoutUser() {
    localStorage.removeItem(USER_DATA_KEY);
    alert('You have been successfully logged out.');
    window.location.href = "login4.html";
}

// --- CORE SCRIPT: SECURITY CHECK and DATA LOADING ---
document.addEventListener('DOMContentLoaded', function() {
    const currentUsername = localStorage.getItem(USER_DATA_KEY);
    const resultDiv = document.getElementById('result');

    // 1. SECURITY CHECK: Ensure user is logged in
    if (!currentUsername) {
        alert('You must be logged in to view the results.');
        window.location.href = "login4.html"; 
        return; // Stop execution
    }

    // 2. DATA LOADING (Use the user-specific key)
    const farmDataString = localStorage.getItem(FORM_DATA_PREFIX + currentUsername);

    if (!farmDataString) {
        resultDiv.innerHTML = `
            <div class="result-box missing-data-box">
                <h2>‚ö†Ô∏è ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥≤‡¥≠‡µç‡¥Ø‡¥Æ‡¥≤‡µç‡¥≤</h2>
                <p>‡¥â‡¥™‡¥Ø‡µã‡¥ï‡µç‡¥§‡¥æ‡¥µ‡µç <span style="font-weight:700;">${currentUsername}</span>-‡¥®‡µç ‡¥µ‡µá‡¥£‡µç‡¥ü‡¥ø ‡¥ï‡µÉ‡¥∑‡¥ø‡¥≠‡µÇ‡¥Æ‡¥ø ‡¥°‡¥æ‡¥±‡µç‡¥±‡¥Ø‡µä‡¥®‡µç‡¥®‡µÅ‡¥Ç ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥ø‡¥≤‡µç‡¥≤. ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥µ‡¥ø‡¥∂‡¥¶‡¥æ‡¥Ç‡¥∂‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µΩ‡¥ï‡¥æ‡µª ‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø '‡¥ï‡µÉ‡¥∑‡¥ø‡¥≠‡µÇ‡¥Æ‡¥ø ‡¥°‡¥æ‡¥±‡µç‡¥±' ‡¥ü‡¥æ‡¥¨‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥ï.</p>
                <p style="margin-top:10px;"><a href="farmdata.html" style="color:var(--red-alert); text-decoration: underline;">‡¥ï‡µÉ‡¥∑‡¥ø‡¥≠‡µÇ‡¥Æ‡¥ø ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥™‡µá‡¥ú‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥ï</a></p>
            </div>
        `;
        return;
    }

    // 3. Parse Data
    const data = JSON.parse(farmDataString);

    // 4. Generate Soil Recommendation (Example Logic)
    let soilRecommendation = '';
    if (data.ph < PH_OPTIMAL - 0.5) {
        soilRecommendation = `‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥≤‡µÜ pH ‡¥ï‡µÅ‡¥±‡¥µ‡¥æ‡¥£‡µç (${data.ph}). ‡¥∂‡µÅ‡¥™‡¥æ‡µº‡¥∂: ‡¥Æ‡¥ø‡¥ï‡¥ö‡µç‡¥ö ‡¥™‡µã‡¥∑‡¥ï ‡¥≤‡¥≠‡µç‡¥Ø‡¥§‡¥Ø‡µç‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø pH ‡¥µ‡µº‡¥¶‡µç‡¥ß‡¥ø‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥ï‡µÅ‡¥Æ‡µç‡¥Æ‡¥æ‡¥Ø‡¥Ç (Lime) ‡¥™‡µç‡¥∞‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.`;
    } else if (data.ph > PH_OPTIMAL + 0.5) {
        soilRecommendation = `‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥≤‡µÜ pH ‡¥ï‡µÇ‡¥ü‡µÅ‡¥§‡¥≤‡¥æ‡¥£‡µç (${data.ph}). ‡¥∂‡µÅ‡¥™‡¥æ‡µº‡¥∂: pH ‡¥ï‡µÅ‡¥±‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡¥®‡µÅ‡¥Ç ‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥ò‡¥ü‡¥® ‡¥Æ‡µÜ‡¥ö‡µç‡¥ö‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥§‡µç‡¥§‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡¥®‡µÅ‡¥Ç ‡¥∏‡µæ‡¥´‡¥±‡µã ‡¥ú‡¥ø‡¥™‡µç‚Äå‡¥∏‡¥µ‡µÅ‡¥Ç ‡¥™‡µç‡¥∞‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.`;
    } else {
        soilRecommendation = `‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥≤‡µÜ pH (${data.ph}) ‡¥í‡¥™‡µç‡¥±‡µç‡¥±‡¥ø‡¥Æ‡µΩ ‡¥Ü‡¥£‡µç. ‡¥™‡µã‡¥∑‡¥ï ‡¥∏‡¥®‡µç‡¥§‡µÅ‡¥≤‡¥ø‡¥§‡¥æ‡¥µ‡¥∏‡µç‡¥• ‡¥®‡¥ø‡¥≤‡¥®‡¥ø‡µº‡¥§‡µç‡¥§‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡µΩ ‡¥∂‡µç‡¥∞‡¥¶‡µç‡¥ß ‡¥ï‡µá‡¥®‡µç‡¥¶‡µç‡¥∞‡µÄ‡¥ï‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.`;
    }
    
    // 5. Generate NPK Recommendation (Example Logic)
    let NPKRecommendation = [];
    if (data.N < 100) NPKRecommendation.push(`‡¥®‡µà‡¥ü‡µç‡¥∞‡¥ú‡µª (N): ‡¥ï‡µÅ‡¥±‡¥µ‡¥æ‡¥£‡µç. ‡¥â‡¥Ø‡µº‡¥®‡µç‡¥® ‡¥®‡µà‡¥ü‡µç‡¥∞‡¥ú‡µª ‡¥µ‡¥≥‡¥ô‡µç‡¥ô‡¥≥‡¥æ‡¥Ø ‡¥Ø‡µÇ‡¥±‡¥ø‡¥Ø ‡¥™‡µç‡¥∞‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.`);
    if (data.P < 80) NPKRecommendation.push(`‡¥´‡µã‡¥∏‡µç‡¥´‡¥±‡¥∏‡µç (P): ‡¥ï‡µÅ‡¥±‡¥µ‡¥æ‡¥£‡µç. DAP ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥∏‡µÇ‡¥™‡µç‡¥™‡µº‡¥´‡µã‡¥∏‡µç‡¥´‡µá‡¥±‡µç‡¥±‡µç ‡¥™‡µç‡¥∞‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.`);
    if (data.K < 60) NPKRecommendation.push(`‡¥™‡µä‡¥ü‡µç‡¥ü‡¥æ‡¥∏‡µç‡¥Ø‡¥Ç (K): ‡¥ï‡µÅ‡¥±‡¥µ‡¥æ‡¥£‡µç. ‡¥Æ‡µç‡¥Ø‡µÇ‡¥±‡¥ø‡¥Ø‡µá‡¥±‡µç‡¥±‡µç ‡¥ì‡¥´‡µç ‡¥™‡µä‡¥ü‡µç‡¥ü‡¥æ‡¥∑‡µç (MOP) ‡¥™‡µç‡¥∞‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.`);
    
    if (NPKRecommendation.length === 0) {
        NPKRecommendation.push("NPK ‡¥®‡¥ø‡¥≤‡¥ï‡µæ: ‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥®‡¥ø‡¥≤‡¥ï‡¥≥‡µÅ‡¥Ç ‡¥§‡µÉ‡¥™‡µç‡¥§‡¥ø‡¥ï‡¥∞‡¥Æ‡¥æ‡¥£‡µç. ‡¥®‡¥ø‡¥∞‡µÄ‡¥ï‡µç‡¥∑‡¥£‡¥Ç ‡¥§‡µÅ‡¥ü‡¥∞‡µÅ‡¥ï.");
    }


    // 6. Display Results
    resultDiv.innerHTML = `
        <h2>‚úÖ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∏‡µç‡¥Æ‡¥æ‡µº‡¥ü‡µç‡¥ü‡µç ‡¥´‡¥æ‡¥Ç ‡¥∂‡µÅ‡¥™‡¥æ‡µº‡¥∂‡¥ï‡µæ</h2>
        <p style="text-align: center;"><span style="font-weight: 600;">${currentUsername}</span>-‡¥®‡¥æ‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç | ‡¥°‡¥æ‡¥±‡µç‡¥± ${data.timestamp ? new Date(data.timestamp).toLocaleString() : 'N/A'} ‡¥Æ‡µÅ‡¥§‡µΩ</p>

        <div class="section">
            <h3>üöú ‡¥á‡µª‡¥™‡µÅ‡¥ü‡µç‡¥ü‡µç ‡¥∏‡¥Ç‡¥ó‡µç‡¥∞‡¥π‡¥Ç</h3>
            <div class="info-pair"><span class="label">‡¥∏‡µç‡¥•‡¥≤‡¥Ç:</span><span class="value">${data.location}</span></div>
            <div class="info-pair"><span class="label">‡¥Æ‡µÅ‡µª‡¥™‡¥§‡µç‡¥§‡µÜ ‡¥µ‡¥ø‡¥≥:</span><span class="value">${data.prevCrop}</span></div>
            <div class="info-pair"><span class="label">‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥§‡¥∞‡¥Ç:</span><span class="value">${data.soilType}</span></div>
            <div class="info-pair"><span class="label">‡¥∂‡¥∞‡¥æ‡¥∂‡¥∞‡¥ø ‡¥§‡¥æ‡¥™‡¥®‡¥ø‡¥≤:</span><span class="value">${data.temp}¬∞C</span></div>
        </div>

        <div class="section">
            <h3>üß™ ‡¥Æ‡¥£‡µç‡¥£‡µÅ‡¥Ç ‡¥™‡µã‡¥∑‡¥ï ‡¥Ö‡¥≥‡¥µ‡µÅ‡¥ï‡¥≥‡µÅ‡¥Ç</h3>
            <div class="info-pair"><span class="label">pH ‡¥≤‡µÜ‡¥µ‡µΩ:</span><span class="value">${data.ph.toFixed(1)} (‡¥í‡¥™‡µç‡¥±‡µç‡¥±‡¥ø‡¥Æ‡µΩ: ${PH_OPTIMAL})</span></div>
            <div class="info-pair"><span class="label">‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥≤‡µÜ ‡¥à‡µº‡¥™‡µç‡¥™‡¥Ç:</span><span class="value">${data.moisture}%</span></div>
            <div class="info-pair"><span class="label">‡¥®‡µà‡¥ü‡µç‡¥∞‡¥ú‡µª (N):</span><span class="value">${data.N} kg/ha</span></div>
            <div class="info-pair"><span class="label">‡¥´‡µã‡¥∏‡µç‡¥´‡¥±‡¥∏‡µç (P):</span><span class="value">${data.P} kg/ha</span></div>
            <div class="info-pair"><span class="label">‡¥™‡µä‡¥ü‡µç‡¥ü‡¥æ‡¥∏‡µç‡¥Ø‡¥Ç (K):</span><span class="value">${data.K} kg/ha</span></div>
        </div>
        
        <div class="section">
            <h3>üí° ‡¥µ‡¥ø‡¥∂‡¥¶‡¥Æ‡¥æ‡¥Ø ‡¥∂‡µÅ‡¥™‡¥æ‡µº‡¥∂‡¥ï‡µæ</h3>
            <h4>‡¥Æ‡¥£‡µç‡¥£‡µç ‡¥ö‡¥ø‡¥ï‡¥ø‡¥§‡µç‡¥∏:</h4>
            <p>${soilRecommendation}</p>
            
            <h4 style="margin-top:15px;">‡¥™‡µã‡¥∑‡¥ï ‡¥ï‡µç‡¥∞‡¥Æ‡µÄ‡¥ï‡¥∞‡¥£‡¥Ç:</h4>
            <ul style="list-style-type: none; padding-left: 0;">
                ${NPKRecommendation.map(item => `<li>${item}</li>`).join('')}
            </ul>
        </div>
        
        <div class="section cost-section">
            <h3>üí∞ ‡¥ï‡¥£‡¥ï‡µç‡¥ï‡¥æ‡¥ï‡µç‡¥ï‡¥ø‡¥Ø ‡¥ö‡µÜ‡¥≤‡¥µ‡µç ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ (‚Çπ)</h3>
            <div class="info-pair"><span class="label">‡¥µ‡¥≥‡¥§‡µç‡¥§‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥ö‡µÜ‡¥≤‡¥µ‡µç:</span><span class="value">‚Çπ${data.fertilizerCost.toFixed(2)}</span></div>
            <div class="info-pair"><span class="label">‡¥ú‡¥≤‡¥∏‡µá‡¥ö‡¥® ‡¥ö‡µÜ‡¥≤‡¥µ‡µç:</span><span class="value">‚Çπ${data.irrigationCost.toFixed(2)}</span></div>
            <div class="info-pair"><span class="label">‡¥Æ‡¥£‡µç‡¥£‡µç ‡¥ö‡¥ø‡¥ï‡¥ø‡¥§‡µç‡¥∏‡¥æ ‡¥ö‡µÜ‡¥≤‡¥µ‡µç:</span><span class="value">‚Çπ${data.soilTreatmentCost.toFixed(2)}</span></div>
            <div class="info-pair"><span class="label">IoT ‡¥™‡¥∞‡¥ø‡¥™‡¥æ‡¥≤‡¥® ‡¥ö‡µÜ‡¥≤‡¥µ‡µç:</span><span class="value">‚Çπ${data.IoTCost.toFixed(2)}</span></div>
        </div>

        <div class="total">
            ‚ú® ‡¥™‡µç‡¥∞‡¥§‡µÄ‡¥ï‡µç‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥® ‡¥Ü‡¥ï‡µÜ ‡¥ï‡µÉ‡¥∑‡¥ø‡¥≠‡µÇ‡¥Æ‡¥ø ‡¥ö‡µÜ‡¥≤‡¥µ‡µç: ‚Çπ${data.totalCost.toFixed(2)}
        </div>
    `;
});
</script>
</body>
</html>